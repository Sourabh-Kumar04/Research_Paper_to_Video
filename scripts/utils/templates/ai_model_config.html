<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Model Configuration - RASO Platform</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .header p {
            opacity: 0.9;
            font-size: 1.1em;
        }
        
        .content {
            padding: 30px;
        }
        
        .section {
            margin-bottom: 40px;
            padding: 25px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            background: #fafafa;
        }
        
        .section h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.5em;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }
        
        .system-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .info-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #3498db;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .info-card h3 {
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        .info-card .value {
            font-size: 1.5em;
            font-weight: bold;
            color: #3498db;
        }
        
        .preset-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .preset-card {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }
        
        .preset-card:hover {
            border-color: #3498db;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .preset-card.active {
            border-color: #27ae60;
            background: #e8f5e8;
        }
        
        .preset-card.warning {
            border-color: #f39c12;
            background: #fef9e7;
        }
        
        .preset-card.error {
            border-color: #e74c3c;
            background: #fdf2f2;
        }
        
        .preset-card h3 {
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        .preset-card .description {
            color: #7f8c8d;
            font-size: 0.9em;
            margin-bottom: 10px;
        }
        
        .preset-card .recommendation {
            font-weight: bold;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 0.8em;
        }
        
        .recommendation.recommended {
            background: #27ae60;
            color: white;
        }
        
        .recommendation.caution {
            background: #f39c12;
            color: white;
        }
        
        .recommendation.not-recommended {
            background: #e74c3c;
            color: white;
        }
        
        .model-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .model-card {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            transition: all 0.3s ease;
        }
        
        .model-card:hover {
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .model-card h4 {
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        .model-details {
            margin-bottom: 15px;
        }
        
        .model-details .detail {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: 0.9em;
        }
        
        .model-details .label {
            color: #7f8c8d;
        }
        
        .model-details .value {
            font-weight: bold;
            color: #2c3e50;
        }
        
        .compatibility {
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 0.8em;
            font-weight: bold;
            text-align: center;
        }
        
        .compatibility.compatible {
            background: #d5f4e6;
            color: #27ae60;
        }
        
        .compatibility.incompatible {
            background: #fdf2f2;
            color: #e74c3c;
        }
        
        .btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s ease;
            margin: 5px;
        }
        
        .btn:hover {
            background: #2980b9;
            transform: translateY(-1px);
        }
        
        .btn.success {
            background: #27ae60;
        }
        
        .btn.success:hover {
            background: #229954;
        }
        
        .btn.warning {
            background: #f39c12;
        }
        
        .btn.warning:hover {
            background: #e67e22;
        }
        
        .btn.danger {
            background: #e74c3c;
        }
        
        .btn.danger:hover {
            background: #c0392b;
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .alert {
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
        }
        
        .alert.success {
            background: #d5f4e6;
            color: #27ae60;
            border: 1px solid #27ae60;
        }
        
        .alert.warning {
            background: #fef9e7;
            color: #f39c12;
            border: 1px solid #f39c12;
        }
        
        .alert.error {
            background: #fdf2f2;
            color: #e74c3c;
            border: 1px solid #e74c3c;
        }
        
        .benchmark-results {
            margin-top: 20px;
        }
        
        .benchmark-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .benchmark-table th,
        .benchmark-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .benchmark-table th {
            background: #f8f9fa;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .benchmark-table tr:hover {
            background: #f8f9fa;
        }
        
        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .status-indicator.success {
            background: #27ae60;
        }
        
        .status-indicator.error {
            background: #e74c3c;
        }
        
        .status-indicator.warning {
            background: #f39c12;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ü§ñ AI Model Configuration</h1>
            <p>Configure and optimize AI models for your hardware</p>
        </div>
        
        <div class="content">
            <!-- System Information Section -->
            <div class="section">
                <h2>üñ•Ô∏è System Information</h2>
                <div id="system-info" class="system-info">
                    <div class="loading">
                        <div class="spinner"></div>
                        <p>Loading system information...</p>
                    </div>
                </div>
                <div id="system-alerts"></div>
            </div>
            
            <!-- Model Preset Selection -->
            <div class="section">
                <h2>‚öôÔ∏è Model Presets</h2>
                <p style="margin-bottom: 20px; color: #7f8c8d;">
                    Choose a preset optimized for your hardware and performance requirements.
                </p>
                <div id="preset-selector" class="preset-selector">
                    <div class="loading">
                        <div class="spinner"></div>
                        <p>Loading presets...</p>
                    </div>
                </div>
                <div style="margin-top: 20px;">
                    <button class="btn success" onclick="applyPreset()">Apply Selected Preset</button>
                    <button class="btn" onclick="optimizeForHardware('speed')">Optimize for Speed</button>
                    <button class="btn" onclick="optimizeForHardware('quality')">Optimize for Quality</button>
                    <button class="btn" onclick="optimizeForHardware('balanced')">Optimize Balanced</button>
                </div>
            </div>
            
            <!-- Current Configuration -->
            <div class="section">
                <h2>üìã Current Configuration</h2>
                <div id="current-config">
                    <div class="loading">
                        <div class="spinner"></div>
                        <p>Loading current configuration...</p>
                    </div>
                </div>
            </div>
            
            <!-- Available Models -->
            <div class="section">
                <h2>üìö Available Models</h2>
                <p style="margin-bottom: 20px; color: #7f8c8d;">
                    Browse all available AI models and their compatibility with your system.
                </p>
                <div id="available-models" class="model-grid">
                    <div class="loading">
                        <div class="spinner"></div>
                        <p>Loading available models...</p>
                    </div>
                </div>
            </div>
            
            <!-- Model Management -->
            <div class="section">
                <h2>üîß Model Management</h2>
                <div style="margin-bottom: 20px;">
                    <button class="btn success" onclick="installModels()">Install Recommended Models</button>
                    <button class="btn" onclick="checkModelStatus()">Check Model Status</button>
                    <button class="btn warning" onclick="runBenchmarks()">Run Performance Benchmarks</button>
                </div>
                
                <div id="model-status"></div>
                
                <div id="benchmark-results" class="benchmark-results" style="display: none;">
                    <h3>Performance Benchmarks</h3>
                    <table class="benchmark-table">
                        <thead>
                            <tr>
                                <th>Model</th>
                                <th>Response Time (s)</th>
                                <th>Tokens/Second</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="benchmark-table-body">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentPreset = 'fast';
        let systemInfo = {};
        let availableModels = [];
        
        // Initialize the interface
        document.addEventListener('DOMContentLoaded', function() {
            loadSystemInfo();
            loadCurrentConfig();
            loadAvailableModels();
            setupPresetSelector();
        });
        
        async function loadSystemInfo() {
            try {
                const response = await fetch('/api/system-info');
                const data = await response.json();
                
                if (data.status === 'success') {
                    systemInfo = data.system_info;
                    displaySystemInfo(data.system_info, data.recommendations);
                } else {
                    showAlert('error', 'Failed to load system information: ' + data.message);
                }
            } catch (error) {
                showAlert('error', 'Error loading system information: ' + error.message);
            }
        }
        
        function displaySystemInfo(info, recommendations) {
            const container = document.getElementById('system-info');
            
            container.innerHTML = `
                <div class="info-card">
                    <h3>üíæ Memory</h3>
                    <div class="value">${info.memory_gb.toFixed(1)} GB</div>
                </div>
                <div class="info-card">
                    <h3>üñ•Ô∏è CPU Cores</h3>
                    <div class="value">${info.cpu_count}</div>
                </div>
                <div class="info-card">
                    <h3>üéÆ GPU</h3>
                    <div class="value">${info.gpu_info ? info.gpu_info.name || 'Available' : 'Not Detected'}</div>
                </div>
                <div class="info-card">
                    <h3>‚ö° Recommended Preset</h3>
                    <div class="value">${info.recommended_preset.value || info.recommended_preset}</div>
                </div>
            `;
            
            // Display warnings and recommendations
            const alertsContainer = document.getElementById('system-alerts');
            let alertsHtml = '';
            
            if (recommendations.warnings && recommendations.warnings.length > 0) {
                alertsHtml += '<div class="alert warning"><strong>‚ö†Ô∏è Warnings:</strong><ul>';
                recommendations.warnings.forEach(warning => {
                    alertsHtml += `<li>${warning}</li>`;
                });
                alertsHtml += '</ul></div>';
            }
            
            if (recommendations.optimizations && recommendations.optimizations.length > 0) {
                alertsHtml += '<div class="alert success"><strong>üí° Optimizations:</strong><ul>';
                recommendations.optimizations.forEach(optimization => {
                    alertsHtml += `<li>${optimization}</li>`;
                });
                alertsHtml += '</ul></div>';
            }
            
            alertsContainer.innerHTML = alertsHtml;
        }
        
        function setupPresetSelector() {
            const presets = [
                {
                    name: 'fast',
                    title: 'üöÄ Fast Mode',
                    description: 'Lightweight models optimized for 16GB RAM systems',
                    recommendation: 'recommended'
                },
                {
                    name: 'balanced',
                    title: '‚öñÔ∏è Balanced Mode',
                    description: 'Mid-tier models for systems with 16-32GB RAM',
                    recommendation: 'caution'
                },
                {
                    name: 'quality',
                    title: 'üíé Quality Mode',
                    description: 'Large models for systems with 32GB+ RAM',
                    recommendation: 'not-recommended'
                },
                {
                    name: 'custom',
                    title: 'üîß Custom Mode',
                    description: 'User-defined model combinations',
                    recommendation: 'neutral'
                }
            ];
            
            const container = document.getElementById('preset-selector');
            
            container.innerHTML = presets.map(preset => {
                const memoryGb = systemInfo.memory_gb || 16;
                let cardClass = 'preset-card';
                let recommendationClass = 'recommendation';
                let recommendationText = '';
                
                if (preset.name === 'fast') {
                    cardClass += ' active';
                    recommendationClass += ' recommended';
                    recommendationText = 'RECOMMENDED';
                } else if (preset.name === 'balanced' && memoryGb <= 16) {
                    cardClass += ' warning';
                    recommendationClass += ' caution';
                    recommendationText = 'USE WITH CAUTION';
                } else if (preset.name === 'quality' && memoryGb <= 16) {
                    cardClass += ' error';
                    recommendationClass += ' not-recommended';
                    recommendationText = 'NOT RECOMMENDED';
                } else if (preset.name === 'balanced') {
                    recommendationClass += ' recommended';
                    recommendationText = 'GOOD CHOICE';
                } else if (preset.name === 'quality') {
                    recommendationClass += ' recommended';
                    recommendationText = 'BEST QUALITY';
                } else {
                    recommendationText = 'CUSTOM';
                }
                
                return `
                    <div class="${cardClass}" onclick="selectPreset('${preset.name}')">
                        <h3>${preset.title}</h3>
                        <div class="description">${preset.description}</div>
                        <div class="${recommendationClass}">${recommendationText}</div>
                    </div>
                `;
            }).join('');
        }
        
        function selectPreset(presetName) {
            currentPreset = presetName;
            
            // Update visual selection
            document.querySelectorAll('.preset-card').forEach(card => {
                card.classList.remove('active');
            });
            
            event.target.closest('.preset-card').classList.add('active');
        }
        
        async function applyPreset() {
            try {
                showLoading('Applying preset...');
                
                const response = await fetch('/api/set-preset', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ preset: currentPreset })
                });
                
                const data = await response.json();
                
                if (data.status === 'success') {
                    showAlert('success', data.message);
                    loadCurrentConfig(); // Refresh current config
                } else {
                    showAlert('error', 'Failed to apply preset: ' + data.message);
                }
            } catch (error) {
                showAlert('error', 'Error applying preset: ' + error.message);
            } finally {
                hideLoading();
            }
        }
        
        async function loadCurrentConfig() {
            try {
                const response = await fetch('/api/current-config');
                const data = await response.json();
                
                if (data.status === 'success') {
                    displayCurrentConfig(data.config);
                } else {
                    showAlert('error', 'Failed to load current configuration: ' + data.message);
                }
            } catch (error) {
                showAlert('error', 'Error loading current configuration: ' + error.message);
            }
        }
        
        function displayCurrentConfig(config) {
            const container = document.getElementById('current-config');
            
            let configHtml = `
                <div class="info-card">
                    <h3>Current Preset: <span style="color: #3498db;">${config.current_preset.toUpperCase()}</span></h3>
                </div>
                <div style="margin-top: 20px;">
                    <h4>Selected Models:</h4>
                    <div class="model-grid">
            `;
            
            for (const [taskType, modelName] of Object.entries(config.selected_models)) {
                configHtml += `
                    <div class="model-card">
                        <h4>${taskType.replace('_', ' ').toUpperCase()}</h4>
                        <div class="model-details">
                            <div class="detail">
                                <span class="label">Model:</span>
                                <span class="value">${modelName}</span>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            configHtml += '</div></div>';
            container.innerHTML = configHtml;
        }
        
        async function loadAvailableModels() {
            try {
                const response = await fetch('/api/available-models');
                const data = await response.json();
                
                if (data.status === 'success') {
                    availableModels = data.models;
                    displayAvailableModels(data.models);
                } else {
                    showAlert('error', 'Failed to load available models: ' + data.message);
                }
            } catch (error) {
                showAlert('error', 'Error loading available models: ' + error.message);
            }
        }
        
        function displayAvailableModels(models) {
            const container = document.getElementById('available-models');
            
            container.innerHTML = models.map(model => {
                const compatibilityClass = model.compatible ? 'compatible' : 'incompatible';
                const compatibilityText = model.compatible ? '‚úÖ Compatible' : '‚ùå Incompatible';
                
                return `
                    <div class="model-card">
                        <h4>${model.name}</h4>
                        <div class="model-details">
                            <div class="detail">
                                <span class="label">Type:</span>
                                <span class="value">${model.type}</span>
                            </div>
                            <div class="detail">
                                <span class="label">Size:</span>
                                <span class="value">${model.size_gb.toFixed(1)} GB</span>
                            </div>
                            <div class="detail">
                                <span class="label">Parameters:</span>
                                <span class="value">${model.parameters}</span>
                            </div>
                            <div class="detail">
                                <span class="label">Min RAM:</span>
                                <span class="value">${model.min_ram_gb} GB</span>
                            </div>
                        </div>
                        <div class="compatibility ${compatibilityClass}">
                            ${compatibilityText}
                        </div>
                        <p style="margin-top: 10px; font-size: 0.9em; color: #7f8c8d;">
                            ${model.description}
                        </p>
                    </div>
                `;
            }).join('');
        }
        
        async function optimizeForHardware(priority) {
            try {
                showLoading(`Optimizing for ${priority}...`);
                
                const response = await fetch('/api/optimize-for-hardware', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ priority: priority })
                });
                
                const data = await response.json();
                
                if (data.status === 'success') {
                    showAlert('success', `Hardware optimization complete for ${priority} priority`);
                    
                    // Display recommendations
                    let recommendationHtml = '<div class="alert success"><h4>Recommended Configuration:</h4><ul>';
                    for (const [taskType, modelName] of Object.entries(data.recommendations)) {
                        if (taskType !== 'preset') {
                            recommendationHtml += `<li><strong>${taskType}:</strong> ${modelName}</li>`;
                        }
                    }
                    recommendationHtml += `<li><strong>Preset:</strong> ${data.recommendations.preset}</li></ul></div>`;
                    
                    document.getElementById('system-alerts').innerHTML += recommendationHtml;
                } else {
                    showAlert('error', 'Failed to optimize for hardware: ' + data.message);
                }
            } catch (error) {
                showAlert('error', 'Error optimizing for hardware: ' + error.message);
            } finally {
                hideLoading();
            }
        }
        
        async function installModels() {
            try {
                showLoading('Installing recommended models...');
                
                const response = await fetch('/api/install-models', {
                    method: 'POST'
                });
                
                const data = await response.json();
                
                if (data.status === 'success') {
                    showAlert('success', 'Model installation completed');
                    displayInstallationResults(data.installation.results);
                } else {
                    showAlert('error', 'Failed to install models: ' + data.message);
                }
            } catch (error) {
                showAlert('error', 'Error installing models: ' + error.message);
            } finally {
                hideLoading();
            }
        }
        
        function displayInstallationResults(results) {
            let resultsHtml = '<div class="alert success"><h4>Installation Results:</h4><ul>';
            
            for (const [modelName, result] of Object.entries(results)) {
                const statusIcon = result.status === 'success' ? '‚úÖ' : '‚ùå';
                resultsHtml += `<li>${statusIcon} ${modelName}: ${result.status}</li>`;
            }
            
            resultsHtml += '</ul></div>';
            document.getElementById('model-status').innerHTML = resultsHtml;
        }
        
        async function runBenchmarks() {
            try {
                showLoading('Running performance benchmarks...');
                
                const response = await fetch('/api/benchmark-models', {
                    method: 'POST'
                });
                
                const data = await response.json();
                
                if (data.status === 'success') {
                    showAlert('success', 'Benchmarks completed');
                    displayBenchmarkResults(data.benchmarks.results);
                } else {
                    showAlert('error', 'Failed to run benchmarks: ' + data.message);
                }
            } catch (error) {
                showAlert('error', 'Error running benchmarks: ' + error.message);
            } finally {
                hideLoading();
            }
        }
        
        function displayBenchmarkResults(results) {
            const tableBody = document.getElementById('benchmark-table-body');
            const resultsContainer = document.getElementById('benchmark-results');
            
            tableBody.innerHTML = '';
            
            for (const [modelName, result] of Object.entries(results)) {
                const row = document.createElement('tr');
                
                const statusClass = result.status === 'success' ? 'success' : 'error';
                const statusIcon = result.status === 'success' ? '‚úÖ' : '‚ùå';
                
                row.innerHTML = `
                    <td>${modelName}</td>
                    <td>${result.response_time ? result.response_time.toFixed(2) : 'N/A'}</td>
                    <td>${result.tokens_per_second ? result.tokens_per_second.toFixed(1) : 'N/A'}</td>
                    <td><span class="status-indicator ${statusClass}"></span>${statusIcon} ${result.status}</td>
                `;
                
                tableBody.appendChild(row);
            }
            
            resultsContainer.style.display = 'block';
        }
        
        async function checkModelStatus() {
            try {
                showLoading('Checking model status...');
                
                const response = await fetch('/api/model-status');
                const data = await response.json();
                
                if (data.status === 'success') {
                    showAlert('success', 'Model status check completed');
                    displayModelStatus(data.model_status);
                } else {
                    showAlert('error', 'Failed to check model status: ' + data.message);
                }
            } catch (error) {
                showAlert('error', 'Error checking model status: ' + error.message);
            } finally {
                hideLoading();
            }
        }
        
        function displayModelStatus(status) {
            let statusHtml = '<div class="alert success"><h4>Model Status:</h4>';
            
            if (status.installed_models && status.installed_models.length > 0) {
                statusHtml += '<h5>Installed Models:</h5><ul>';
                status.installed_models.forEach(model => {
                    statusHtml += `<li>‚úÖ ${model.name} (${model.size})</li>`;
                });
                statusHtml += '</ul>';
            }
            
            if (status.available_updates && status.available_updates.length > 0) {
                statusHtml += '<h5>Available Updates:</h5><ul>';
                status.available_updates.forEach(update => {
                    statusHtml += `<li>üîÑ ${update}</li>`;
                });
                statusHtml += '</ul>';
            }
            
            statusHtml += '</div>';
            document.getElementById('model-status').innerHTML = statusHtml;
        }
        
        function showAlert(type, message) {
            const alertsContainer = document.getElementById('system-alerts');
            const alert = document.createElement('div');
            alert.className = `alert ${type}`;
            alert.innerHTML = message;
            
            alertsContainer.appendChild(alert);
            
            // Auto-remove after 5 seconds
            setTimeout(() => {
                alert.remove();
            }, 5000);
        }
        
        function showLoading(message) {
            const loadingElements = document.querySelectorAll('.loading');
            loadingElements.forEach(element => {
                element.style.display = 'block';
                element.querySelector('p').textContent = message;
            });
        }
        
        function hideLoading() {
            const loadingElements = document.querySelectorAll('.loading');
            loadingElements.forEach(element => {
                element.style.display = 'none';
            });
        }
    </script>
</body>
</html>